<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="icon" href="/logo.png" type="image/png">
    <meta name="theme-color" content="#3390ec">
    
    <!-- Prevent caching for development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Прораб360</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            const tg = window.Telegram.WebApp;
            
            // Enable closing confirmation
            tg.enableClosingConfirmation();
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh отключен по запросу пользователя
            
            // Initialize the app
            tg.ready();
        } else {
            // Fallback for non-Telegram browsers
            // Fallback for non-Telegram browsers
            
            // Set viewport height for mobile browsers
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            
            // Pull-to-refresh отключен по запросу пользователя
        }
    });
    </script>

</head>
<body>
    <div id="root"></div>
    <script>
      // Production ready code without debug logs

      // Регистрируем Service Worker только вне localhost, чтобы избежать ошибок в dev
      (function registerSW() {
        try {
          const isLocal = /localhost|127\.0\.0\.1|::1/.test(location.hostname);
          if (!('serviceWorker' in navigator) || isLocal) return;
          window.addEventListener('load', function() {
            navigator.serviceWorker.register('/sw.js').then(function(registration) {
              // SW registered successfully
              // Не форсируем перезагрузку страницы при обновлении SW в продакшене,
              // чтобы исключить потенциальные циклы перезагрузки.
            }).catch(function(err){
              console.warn('SW registration failed', err);
            });
          });
        } catch (e) {
          console.warn('SW registration skipped:', e);
        }
      })();
    </script>
    <script type="module" src="src/index.tsx"></script>
</body>
</html>
